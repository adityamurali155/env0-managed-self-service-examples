version: 1


deploy:
  steps:
    terraformInit:
      after:
        - terraform validate
    terraformApply:
      after:
        - wget https://go.dev/dl/go1.22.5.linux-amd64.tar.gz
        - tar -xvzf go1.22.5.linux-amd64.tar.gz
        - export PATH=$PATH:$(pwd)/go1.22.5.linux-amd64/go/bin
        - go install github.com/aquasecurity/tfsec/cmd/tfsec@latest
        - chmod 755 ./tfsec
        - export PATH=$(pwd):$PATH
        - ./tfsec .