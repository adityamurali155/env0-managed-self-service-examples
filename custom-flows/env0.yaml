version: 1


deploy:
  steps:
    terraformInit:
      after:
        - terraform validate
    terraformApply:
      after:
        - curl -L https://go.dev/dl/go1.22.5.linux-amd64.tar.gz
        - tar -C $(pwd) go1.22.5.linux-amd64.tar.gz
        - export PATH=$(pwd)/go1.22.5.linux-amd64/go/bin:$PATH
        - go install github.com/aquasecurity/tfsec/cmd/tfsec@latest
        - tfsec .