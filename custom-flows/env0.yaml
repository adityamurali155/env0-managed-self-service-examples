version: 1


deploy:
  steps:
    terraformInit:
      after:
        - terraform validate
    terraformApply:
      after:
        - /bin/bash -c "curl -L https://go.dev/dl/go1.22.5.linux-amd64.tar.gz"
        - /bin/bash -c "tar -C $(pwd) -xzf go1.22.5.linux-amd64.tar.gz"
        - /bin/bash -c "export PATH=$(pwd)/go1.22.5.linux-amd64/go/bin:$PATH"
        - /bin/bash -c "go install github.com/aquasecurity/tfsec/cmd/tfsec@latest"
        - /bin/bash -c "tfsec ."